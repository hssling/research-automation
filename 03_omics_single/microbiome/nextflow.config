/*
 * Nextflow configuration template for Phase 2 automation
 * Supports: local, docker, conda, slurm, aws
 * Updated for nf-core/ampliseq microbioma analysis
 */

params {
    // Input / output defaults (overridden by command-line)
    input      = "metadata.tsv"         // Microbiome samplesheet
    outdir     = "../results/microbiome" // Output directory
    email      = "your.email@example.com"
    max_cpus   = 8
    max_memory = "32 GB"
    max_time   = "24h"

    // Microbiome-specific parameters
    primer_f   = 'GTGCCAGCMGCCGCGGTAA'  // 16S foward primer
    primer_r   = 'GGACTACHVGGGTWTCTAAT' // 16S reverse primer
    trunclenf  = null  // Forward read truncation
    trunclenr  = null  // Reverse read truncation
}

process {
    executor   = 'local'    // default executor
    cpus       = 2
    memory     = '4 GB'
    time       = '4h'
    errorStrategy = 'retry'
    maxRetries = 2
}

timeline {
    enabled = true
    file    = "${params.outdir}/pipeline_timeline.html"
}

trace {
    enabled = true
    file    = "${params.outdir}/pipeline_trace.txt"
}

report {
    enabled = true
    file    = "${params.outdir}/pipeline_report.html"
}

dag {
    enabled = true
    file    = "${params.outdir}/pipeline_dag.png"
}

/*
 * Profiles for different environments
 */
profiles {

    // Local laptop/desktop
    local {
        process.executor = 'local'
        docker.enabled   = false
    }

    // Docker reproducibility
    docker {
        docker.enabled   = true
        docker.userEmulation = true
        process.container = 'nfcore/ampliseq:latest'
    }

    // Conda environment
    conda {
        conda.enabled    = true
        conda.cacheDir   = "${baseDir}/../conda"
    }

    // HPC with SLURM
    slurm {
        process.executor = 'slurm'
        process.queue    = 'standard'
        process.cpus     = 8
        process.memory   = '32 GB'
        process.time     = '48h'
        docker.enabled   = false
        conda.enabled    = true
    }

    // AWS Batch
    aws {
        process.executor = 'awsbatch'
        aws.region       = 'us-east-1'
        process.container = 'nfcore/ampliseq:latest'
        docker.enabled   = true
    }
}
