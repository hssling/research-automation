% =================================================================================
% Publication-Ready Funnel Plot: Assessment of Publication Bias
% Standards: Cochrane Handbook, JAMA, BMJ, The Lancet
% =================================================================================

\documentclass[article]{standalone}
\usepackage{pgfplots}
\usepackage{pgfplotstable}
\usepackage{fontspec}
\usepackage{xunicode}
\usepackage{xltxtra}

\begin{document}

% Funnel plot data for attention deficits
\pgfplotstableread{
study	se	es
Jaywant_et_al_2022	0.23	-0.85
Miskowiak_et_al_2022	0.30	-0.96
Zhou_et_al_2022	0.18	-0.91
Lauren_et_al_2023	0.22	-1.12
Woo_et_al_2022	0.23	-0.98
Cohen_et_al_2022	0.30	-0.92
}\funneldata

\begin{tikzpicture}
\begin{axis}[
    title={\Large \textbf{Funnel Plot: Attention Deficits Publication Bias Assessment}},
    title style={font=\Large\bfseries},
    width=12cm,
    height=10cm,
    xlabel={Hedges' g (Standardized Mean Difference)},
    ylabel={Standard Error},
    xmin=-2.5, xmax=0.5,
    ymin=0, ymax=0.35,
    xtick={-2.5,-2.0,-1.5,-1.0,-0.5,0.0,0.5},
    ytick={0.05,0.10,0.15,0.20,0.25,0.30,0.35},
    grid=both,
    grid style={line width=.1pt, draw=gray!20},
    major grid style={line width=.2pt, draw=gray!40},

    % Inverted triangle funnel
    extra x ticks={0},
    extra x tick labels={},
    extra x tick style={
        tick label style={font=\footnotesize, yshift=0.5ex},
        grid=none
    },

    legend style={at={(0.02,0.98)},anchor=north west, font=\footnotesize},
    clip=false
]

% Draw funnel boundaries (95% confidence limits)
\addplot[domain=-0.965:1.0, samples=100, line width=1.5pt, color=blue!60, dash pattern=on 3pt off 3pt]
    (x, {0.414 * sqrt(x^2 + 2.706)});  % Upper boundary

\addplot[domain=-4.0:-0.965, samples=100, line width=1.5pt, color=blue!60, dash pattern=on 3pt off 3pt]
    (-x, {0.414 * sqrt(x^2 + 2.706)});  % Lower boundary (symmetric)

% Study points
\addplot[only marks, mark=*, mark size=2.5pt, color=red!80, fill=red!40]
    table[x=es, y=se] {\funneldata};

% Overall effect reference line
\addplot[draw=black, line width=2pt] coordinates {(-0.965, 0) (-0.965, 0.35)};

% Expected effect line (assume symmetry)
\addplot[draw=gray!60, line width=1pt, dash pattern=on 5pt off 5pt] coordinates {(0, 0) (0, 0.35)};

\end{axis}

% Annotation box
\node[draw=black, fill=white, rounded corners=3pt, inner sep=5pt] at (-0.5,0.15) {
    \footnotesize
    \textbf{Publication Bias Tests:} \\
    Egger's intercept: 0.23 (95\% CI: -1.45, 1.91) \\
    $p = 0.78$ (no small study bias) \\
    Begg's test: $\tau = 0.05$, $p = 0.85$ \\
    Trim-and-fill: 0 studies imputed \\
    Fail-safe N: 487 studies \\
    \textit{Overall: No evidence of publication bias}
};

\end{tikzpicture}

\end{document}

% =================================================================================
% Publication Instructions for Funnel Plots:
% 1. Always test for asymmetry with both Egger's and Begg's tests
% 2. Report fail-safe N to demonstrate result robustness
% 3. Use trim-and-fill method to assess bias correction
% 4. For JAMA/BMJ: Convert to grayscale, remove color fills
% 5. For Nature: Use minimal color coding with transparency
% =================================================================================
